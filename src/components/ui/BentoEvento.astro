---
import { getCollection } from "astro:content";
import Estructura from "@/components/ui/Estructura.astro";

const eventos = await getCollection("events").then(events =>
    events
        .sort((a, b) => new Date(a.data.fecha) - new Date(b.data.fecha))
        .slice(0, 7)
        .map((evento, i) => ({
            ...evento,
            featured: i === 0,
            data: {
                title: evento.data.title,
                fecha: evento.data.fecha,
                image_url: evento.data.image_url || '/placeholder-event.jpg',
                precio: evento.data.precio || 'Consultar'
            }
        }))
);

// Configuración del layout bento (ahora en negro/dorado)
const bentoLayout = [
    {
        classes: "col-span-2 row-span-2 bg-black border-2 border-secondary-ligth",
        type: "featured"
    },
    { classes: "bg-black border border-secondary-ligth", type: "normal" },
    { classes: "bg-black border bborder-secondary-ligth", type: "normal" },
    { classes: "col-span-2 bg-black border-2 border-secondary-ligth", type: "wide" },
    { classes: "bg-black border border-secondary-ligth", type: "normal" },
    { classes: "bg-black border border-secondary-ligth", type: "normal" },
    { classes: "col-span-2 bg-black border-2 border-secondary-ligth", type: "wide" }
];
---
<Estructura>
    <h1
        class="text-4xl md:text-7xl font-special-regular text-secondary-dark text-center mb-12"
    >
        Próximos Eventos
    </h1>

    <main class="grid grid-cols-2 auto-rows-[150px] px-1.5 gap-3 sm:auto-rows-[180px] md:grid-cols-4 md:auto-rows-[200px] md:gap-4">
        {eventos.map((evento, index) => {
            const layout = bentoLayout[index] || bentoLayout[0];
            const isFeatured = layout.type === "featured";

            return (
                <a
                    href={`/eventos/${evento.slug}`}
                    class={`group relative rounded-xl overflow-hidden ${layout.classes} transition-all hover:shadow-lg hover:bg-cuarto-light/30`}
                >
                    {isFeatured ? (

                        <div class="absolute inset-0 flex flex-col justify-center items-center p-6 text-center">
                            <img
                                class="w-24 h-24 md:w-28 md:h-28 object-cover rounded-full mb-6 border-2 border-secondary"
                                src={evento.data.image_url}
                                alt={evento.data.title}
                                loading="lazy"
                            />
                            <h2 class="text-2xl md:text-3xl font-special-regular text-secondary">
                                {evento.data.title}
                            </h2>
                            <p class="text-secondary-light  mt-2 font-body-medium ">
                                {new Date(evento.data.fecha).toLocaleDateString('es-ES', {
                                    weekday: 'long',
                                    day: 'numeric',
                                    month: 'long'
                                })}
                            </p>
                            <p class="text-lg text-secondary-light font-body-medium mt-3">
                                ${evento.data.precio}
                            </p>
                        </div>
                    ) : (
                        <div class="h-full flex flex-col justify-between p-4">
                            <div>
                                <h3 class="text-lg md:text-xl text-secondary-dark font-special-regular line-clamp-2">
                                    {evento.data.title}
                                </h3>
                                <p class="text-xs text-secondary-light font-special-bold mt-1">
                                    {new Date(evento.data.fecha).toLocaleDateString("es-ES")}
                                </p>
                                <p class="text-sm text-secondary-light font-special-bold mt-2">
                                    ${evento.data.precio}
                                </p>
                            </div>
                            {evento.data.image_url && (
                                <img
                                    class="w-12 h-12 md:w-14 md:h-14 object-cover rounded-lg self-end mt-2 border border-secondary-light"
                                    src={evento.data.image_url}
                                    alt={evento.data.title}
                                    loading="lazy"
                                />
                            )}
                        </div>
                    )}

                    <!-- Efecto hover sutil -->
                    <div class="absolute inset-0 bg-amber-900/0 group-hover:bg-amber-900/10 transition-all duration-300" />
                </a>
            );
        })}
    </main>
</Estructura>
